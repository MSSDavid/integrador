language: php

php:
  - "7.1"
env:
  - COMPOSER_ALLOW_SUPERUSER=1
before_script:
    - composer update
build:
  ci:
    - mkdir -p shippable/testresults
    - mkdir -p shippable/codecoverage
    - phpunit --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage
    - echo "testing"
  push:
    # Prove the files were written correctly
    - cd ..
    - ls -a shippable/testresults
    - cat shippable/testresults/junit.xml
    # check in test results for offline use
    - git add shippable
    - git add imgboard/composer.*
    # suppress infinite loop on ci
    - git commit -m 'update test results [skip ci]'
    - git push